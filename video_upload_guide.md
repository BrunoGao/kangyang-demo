# 📹 视频上传测试使用指南

## 🚀 功能概述

更新后的视频测试系统现在支持：
- ✅ **拖拽上传**: 直接拖拽MP4文件到上传区域
- ✅ **文件选择**: 点击按钮选择本地视频文件
- ✅ **进度显示**: 实时显示上传进度
- ✅ **视频管理**: 查看、选择、删除已上传的视频
- ✅ **自定义测试**: 选择上传的视频进行算法测试

## 📤 视频上传功能

### 支持的视频格式
```
✅ MP4 (推荐)
✅ AVI
✅ MOV  
✅ MKV
✅ WMV
✅ FLV
✅ M4V
```

### 上传限制
- 最大文件大小: **200MB**
- 推荐分辨率: 1280x720 或 1920x1080
- 推荐帧率: 25-30 FPS

### 上传方式

#### 方式1: 拖拽上传
1. 准备好MP4视频文件
2. 直接拖拽到"📤 视频上传"区域
3. 等待上传完成

#### 方式2: 文件选择
1. 点击"选择视频文件"按钮
2. 在文件对话框中选择视频
3. 确认上传

## 🧪 自定义测试流程

### 完整测试步骤

1. **上传视频文件**
   ```
   📤 视频上传区域
   └── 拖拽或选择 fall_test.mp4
   └── 等待上传完成: fall_test_20240820_195500.mp4 (15.2MB)
   ```

2. **选择测试配置**
   ```
   📹 选择视频文件: fall_test_20240820_195500.mp4
   ⚙️ 测试配置: 
   - 检测类型: 仅跌倒检测
   - 处理帧数: 100
   ```

3. **开始测试**
   ```
   🚀 开始自定义测试
   ✅ 测试已启动，会话ID: test_1692547890
   ```

4. **查看结果**
   ```
   📊 检测结果:
   - 总检测数: 3
   - 告警数量: 2  
   - 平均置信度: 87%
   - 处理时间: 1.2s
   ```

## 📋 测试场景示例

### 跌倒检测测试
```bash
# 上传跌倒视频
elderly_fall.mp4 → 自动重命名为: elderly_fall_20240820_195500.mp4

# 测试配置
检测类型: 仅跌倒检测
处理帧数: 150

# 预期结果
🤕 FALL 检测 (3次)
帧 45 - 置信度: 89.1% (时间: 1.5s)
帧 67 - 置信度: 85.3% (时间: 2.2s)
帧 89 - 置信度: 91.7% (时间: 3.0s)

🚨 告警信息:
HIGH: 检测到跌倒事件 (帧:45)
HIGH: 检测到跌倒事件 (帧:89)
```

### 火灾检测测试
```bash
# 上传火灾视频
kitchen_fire.mp4 → kitchen_fire_20240820_200015.mp4

# 测试配置  
检测类型: 仅火焰检测
处理帧数: 200

# 预期结果
🔥 FIRE 检测 (5次)
帧 23 - 置信度: 78.4% (时间: 0.8s)
帧 45 - 置信度: 85.1% (时间: 1.5s)

💨 SMOKE 检测 (3次)
帧 78 - 置信度: 67.2% (时间: 2.6s)

🚨 告警信息:
CRITICAL: 检测到fire (帧:45)
HIGH: 检测到smoke (帧:78)
```

## 🔧 API使用示例

### 上传视频文件
```bash
curl -X POST http://localhost:5557/api/upload_video \
  -F "video=@/path/to/test_video.mp4"

# 响应
{
  "success": true,
  "filename": "test_video_20240820_195500.mp4",
  "original_name": "test_video.mp4",
  "size_mb": 15.2,
  "message": "视频上传成功: test_video.mp4 (15.2MB)"
}
```

### 列出已上传视频
```bash
curl http://localhost:5557/api/list_videos

# 响应
{
  "videos": [
    {
      "filename": "test_video_20240820_195500.mp4",
      "size_mb": 15.2,
      "upload_time": "2024-08-20 19:55:00",
      "extension": "mp4"
    }
  ],
  "total": 1
}
```

### 使用上传的视频进行测试
```bash
curl -X POST http://localhost:5557/api/test_video \
  -H "Content-Type: application/json" \
  -d '{
    "video_name": "test_video_20240820_195500.mp4",
    "test_type": "fall",
    "frame_count": 100
  }'

# 响应
{
  "success": true,
  "session_id": "test_1692547890",
  "message": "视频检测测试已启动: test_video_20240820_195500.mp4"
}
```

## 📊 界面功能说明

### 视频管理区域
```
📂 已上传的视频文件
┌─────────────────────────────────────────┐
│ 📹 elderly_fall_20240820_195500.mp4    │ [选择] [删除]
│ 大小: 15.2MB | 上传时间: 2024-08-20 19:55:00 | 格式: MP4
├─────────────────────────────────────────┤
│ 📹 kitchen_fire_20240820_200015.mp4    │ [选择] [删除]  
│ 大小: 28.7MB | 上传时间: 2024-08-20 20:00:15 | 格式: MP4
└─────────────────────────────────────────┘
```

### 测试配置选项
```
📹 选择视频文件: [下拉选择框]
├── elderly_fall_20240820_195500.mp4 (15.2MB)
├── kitchen_fire_20240820_200015.mp4 (28.7MB)
└── 选择已上传的视频...

⚙️ 测试配置:
├── 检测类型: [全部检测/仅跌倒检测/仅火焰检测]
└── 处理帧数: [10-1000]
```

## ⚠️ 注意事项

### 视频文件要求
1. **跌倒检测视频**:
   - 包含清晰的人体运动
   - 光线充足，避免逆光
   - 人物占画面比例适中
   - 避免快速镜头移动

2. **火焰检测视频**:
   - 火焰颜色鲜明（红/橙/黄）
   - 避免过度曝光
   - 背景不过于复杂
   - 烟雾有明显纹理变化

### 性能优化建议
- 文件大小控制在50MB以内
- 时长建议30-120秒
- 分辨率不超过1920x1080
- 避免超高帧率视频

### 常见问题解决

**Q: 上传失败"文件格式不支持"**
A: 确保文件是视频格式，文件扩展名正确

**Q: 上传速度慢**  
A: 检查网络连接，大文件建议压缩后上传

**Q: 测试无检测结果**
A: 检查视频内容是否包含目标场景，调整处理帧数

**Q: 检测结果置信度低**
A: 选择更清晰的视频，或调整算法参数

## 🎯 推荐测试流程

1. **准备测试视频** (建议多个场景)
   - elderly_fall.mp4 (卧室跌倒)
   - bathroom_fall.mp4 (卫生间跌倒)  
   - kitchen_fire.mp4 (厨房火灾)
   - smoke_test.mp4 (烟雾场景)

2. **批量上传测试**
   - 逐个上传视频文件
   - 验证上传成功和文件信息

3. **系统性测试**
   - 每个视频选择对应的检测类型
   - 记录检测结果和性能数据
   - 对比不同场景的算法表现

4. **结果分析**
   - 统计检测准确率
   - 分析误报和漏报情况
   - 优化算法参数

现在您可以上传真实的MP4视频文件进行完整的算法测试了！🎬